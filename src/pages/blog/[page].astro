---
import Footer from '@site/components/Footer.astro';
import Header from '@site/components/Header.astro';
import HeaderContent from '@site/components/HeaderContent.astro';
import PostList from '@site/components/PostList';
import Layout from '@site/layouts/Layout.astro';
import { fetchPosts } from '@site/utils/blog';
import '@site/styles/global.css'

const { page } = Astro.params;
const result = await fetchPosts(page);
const pageNum = result?.totalDocuments ? Math.ceil(result.totalDocuments / 10) : 0;

const pageList = Array.from({ length: pageNum }, (_, index) => index + 1);
const posts = result ? result.edges : [];
const nextPage = result?.pageInfo.nextPage
const previousPage = result?.pageInfo.previousPage

export async function getStaticPaths() {
    const result = await fetchPosts();

    if (result) {
        const postCount = result.totalDocuments;

        // On every page, 10 posts are shown
        const pages = Math.ceil(postCount / 10);

        return Array.from({ length: pages }, (_, index) => ({
            params: { page: index + 1 }
        }));
    } else {
        return [];
    }
}
---

<Layout title={`Page ${page} | Blog | Lijucay`}`>
    <PostList client:load posts={posts} pageList={pageList} currentPage={page} nextPage={nextPage} previousPage={previousPage}/>
    <Footer/>
</Layout>